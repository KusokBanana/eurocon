$(document).ready(function(){var a=$(".pagination");$("body").on("click",".pagination a",function(h){h.preventDefault();var i=$(this).closest(".pagination").attr("data-addition"),g=$(this).closest("ul").attr("data-wrapSelector");i=JSON.parse(i);i.action="pagination";i=JSON.stringify(i);var f=(g)?$(g):false;e(i,$(this),$(this).attr("href"),f)}).on("keyup focusout",".search-ajax-field",function(h){if((h.type==="keyup"&&h.keyCode===13)||h.type==="focusout"){h.preventDefault();var i=$(this).attr("data-addition"),g=$(this).attr("data-wrap"),f=(g)?$(g):false;i=JSON.parse(i);i=(i.length===0)?{}:i;i.action="search";i.search=$(this).val();i=JSON.stringify(i);e(i,$(this),$(this).attr("data-href"),f)}}).on("click change",".filter-ajax-tabs",function(j){var g=$(this).attr("name"),i=$(this).val(),h=$(this).closest(".filter-tab-info"),k=h.attr("data-addition"),f=h.attr("data-href");k=JSON.parse(k);k[g]=i;k=JSON.stringify(k);e(k,$(this),f)}).on("change","form.ajax-reload-filter",function(j){var h=$(this),k=h.attr("data-addition"),i=h.serializeArray(),g=h.attr("data-wrapSelector");k=JSON.parse(k);k.filter=i;k=JSON.stringify(k);var f=(g)?$(g):false;e(k,$(this),h.attr("action"),f)});function e(i,g,f,h){if(!f||f===undefined){return false}$.ajax({url:f,type:"POST",data:{data:i},success:function(j){if(j){h=(h)?h:g.closest(".tab-pane");h.empty().append(j);if(typeof initSwitcheries==="function"){initSwitcheries()}}}})}function d(n){var k=n.target.files;var h=$(n.target),m=h.closest(".form-group").next(".image-input-preview-block").empty();for(var j=0,l;l=k[j];j++){if(!l.type.match("image.*")){alert("Image only please....")}var g=new FileReader();g.onload=(function(f){return function(o){var i='<div class="col-md-4 col-xs-12"><div class="example">';i+='<img class="img-rounded img-bordered img-bordered-primary" src="'+o.target.result+'" title="'+f.name+'">';i+="</div></div>";m.append(i)}})(l);g.readAsDataURL(l)}}$("body").on("change",".image-input-with-preview",d);$("body").on("click","a.link-disallow, button.link-disallow",function(h){h.preventDefault();h.stopPropagation();var f=$(this).attr("href");var g=($(this).attr("data-toggle")==="modal");if(g){var i=$($(this).attr("data-target"));if(i.length){$($(this).attr("data-target")).remove()}}$.ajax({url:"/site/ajax-sign?type=login",success:function(k){if(k){var j=$("#ajaxSignModal");j.remove();$("body").append(k);$("#ajaxSignModal").attr("data-href",f).modal();b()}},error:function(j,l,k){console.log("Ошибка '"+j.status+"' (textStatus: '"+l+"', errorThrown: '"+k+"')")}});return false}).on("submit","#ajaxSignModal form",function(j){j.preventDefault();var i=$(this),g=$(this).serialize(),h=i.closest("#ajaxSignModal"),f=i.attr("data-type");$.ajax({url:"/site/ajax-sign?action=send&type="+f,type:"POST",data:g,success:function(m){if(m){m=JSON.parse(m);var l=m.content;if(m.success){i.closest(".ajax-content-block").replaceWith(l);b();var k=h.attr("data-href");if(!!k){window.location.href=k}else{h.modal("hide");h.remove()}}else{i.closest(".ajax-content-block").replaceWith(l)}}}})}).on("click","#ajaxSignModal .ajax-sign-toggle",function(h){h.preventDefault();var f=$(this),g=f.attr("data-type");$.ajax({url:"/site/ajax-sign?action=toggle&type="+g,success:function(i){if(i){f.closest(".ajax-content-block").replaceWith(i);b()}}})}).on("click",".input-search button.input-search-close.icon.wb-close",function(){var f=$(this).prev("input");if(f.length){f.val("").trigger("focusout")}});c();function c(){var g=$("#miniChat"),j=g.closest("li.nav-item"),f=g.find(".mini-chat-content"),k=j.find(".mini-chat-count"),i=1;function h(l){if(!i){return false}var m=(l!==undefined)?l:j.is(".open");$.ajax({url:"/chat/mini/render?isOnlyCount="+(!m),success:function(p){if(p){if(p==="quest"){i=0}else{p=JSON.parse(p);var o=p.count;if(+o){k.text(o).parent().show()}else{k.text("").parent().hide()}if(m){var n=p.content;f.empty();if(n){f.append(n)}f.closest('[data-role="container"]').css("height","auto")}}}}})}$("body").on("click","#miniChatLink",function(){h(true)});setInterval(h,4000)}function b(){var f=$("#geoCountry");var g=$("#geoCity");if(f.length){var h=[];$.ajax({url:"/site/get-countries",dataType:"json",async:false,success:function(i){h=i}});f.select2({data:h,placeholder:"Select a country ..."});g.select2();$("body").on("change","#geoCountry",function(j){var i=$(this).val();if(i){g.select2().val(null).select2({ajax:{url:"/site/get-countries?country="+i,dataType:"json",delay:250,cache:true}})}})}}});