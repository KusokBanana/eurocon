$(document).ready(function(){var a=$(".pagination");$("body").on("click",".pagination a",function(h){h.preventDefault();var i=$(this).closest(".pagination").attr("data-addition"),g=$(this).closest("ul").attr("data-wrapSelector");i=JSON.parse(i);i.action="pagination";i=JSON.stringify(i);var f=(g)?$(g):false;d(i,$(this),$(this).attr("href"),f)}).on("keyup focusout",".search-ajax-field",function(h){if((h.type==="keyup"&&h.keyCode===13)||h.type==="focusout"){h.preventDefault();var i=$(this).attr("data-addition"),g=$(this).attr("data-wrap"),f=(g)?$(g):false;i=JSON.parse(i);i=(i.length===0)?{}:i;i.action="search";i.search=$(this).val();i=JSON.stringify(i);d(i,$(this),$(this).attr("data-href"),f)}}).on("click change",".filter-ajax-tabs",function(j){var g=$(this).attr("name"),i=$(this).val(),h=$(this).closest(".filter-tab-info"),k=h.attr("data-addition"),f=h.attr("data-href");k=JSON.parse(k);k[g]=i;k=JSON.stringify(k);d(k,$(this),f)}).on("change","form.ajax-reload-filter",function(j){var h=$(this),k=h.attr("data-addition"),i=h.serializeArray(),g=h.attr("data-wrapSelector");k=JSON.parse(k);k.filter=i;k=JSON.stringify(k);var f=(g)?$(g):false;d(k,$(this),h.attr("action"),f)});function d(h,f,e,g){if(!e||e===undefined){return false}$.ajax({url:e,type:"POST",data:{data:h},success:function(i){if(i){g=(g)?g:f.closest(".tab-pane");g.empty().append(i);if(typeof initSwitcheries==="function"){initSwitcheries()}}}})}function c(n){var k=n.target.files;var h=$(n.target),m=h.closest(".form-group").next(".image-input-preview-block").empty();for(var j=0,l;l=k[j];j++){if(!l.type.match("image.*")){alert("Image only please....")}var g=new FileReader();g.onload=(function(e){return function(i){var f='<div class="col-md-4 col-xs-12"><div class="example">';f+='<img class="img-rounded img-bordered img-bordered-primary" src="'+i.target.result+'" title="'+e.name+'">';f+="</div></div>";m.append(f)}})(l);g.readAsDataURL(l)}}$("body").on("change",".image-input-with-preview",c);$("body").on("click","a.link-disallow, button.link-disallow",function(h){h.preventDefault();h.stopPropagation();var f=$(this).attr("href");var g=($(this).attr("data-toggle")==="modal");if(g){var i=$($(this).attr("data-target"));if(i.length){$($(this).attr("data-target")).remove()}}$.ajax({url:"/site/ajax-sign?type=login",success:function(j){if(j){var e=$("#ajaxSignModal");e.remove();$("body").append(j);$("#ajaxSignModal").attr("data-href",f).modal()}},error:function(e,k,j){console.log("Ошибка '"+e.status+"' (textStatus: '"+k+"', errorThrown: '"+j+"')")}});return false}).on("submit","#ajaxSignModal form",function(j){j.preventDefault();var i=$(this),g=$(this).serialize(),h=i.closest("#ajaxSignModal"),f=i.attr("data-type");$.ajax({url:"/site/ajax-sign?action=send&type="+f,type:"POST",data:g,success:function(l){if(l){l=JSON.parse(l);var k=l.content;if(l.success){i.closest(".ajax-content-block").replaceWith(k);var e=h.attr("data-href");if(!!e){window.location.href=e}else{h.modal("hide");h.remove()}}else{i.closest(".ajax-content-block").replaceWith(k)}}}})}).on("click","#ajaxSignModal .ajax-sign-toggle",function(h){h.preventDefault();var f=$(this),g=f.attr("data-type");$.ajax({url:"/site/ajax-sign?action=toggle&type="+g,success:function(e){if(e){f.closest(".ajax-content-block").replaceWith(e)}}})}).on("click",".input-search button.input-search-close.icon.wb-close",function(){var e=$(this).prev("input");if(e.length){e.val("").trigger("focusout")}});b();function b(){var f=$("#miniChat"),i=f.closest("li.nav-item"),e=f.find(".mini-chat-content"),j=i.find(".mini-chat-count"),h=1;function g(k){if(!h){return false}var l=(k!==undefined)?k:i.is(".open");$.ajax({url:"/chat/mini/render?isOnlyCount="+(!l),success:function(o){if(o){if(o==="quest"){h=0}else{o=JSON.parse(o);var n=o.count;if(+n){j.text(n).parent().show()}else{j.text("").parent().hide()}if(l){var m=o.content;e.empty();if(m){e.append(m)}e.closest('[data-role="container"]').css("height","auto")}}}}})}$("body").on("click","#miniChatLink",function(){g(true)});setInterval(g,4000)}});